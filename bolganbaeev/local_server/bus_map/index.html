<!DOCTYPE html>
<html>
<head>
  <title>Bus Map</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map {
      height: 100vh;
    }
  </style>
</head>
<body>
    <label for="number">–ú–∞—Ä—à—Ä—É—Ç—Ç—ã —Ç–∞“£–¥–∞:</label>
<select id="number">
  <option value="1">1</option>
  <option value="1">1A</option>
  <option value="2">2</option>
  <option value="2">2A</option>
  <option value="5">4</option>
  <option value="5">4A</option>
  <option value="5">5</option>
  <option value="5A">5A</option>
  <option value="6">6</option>
  <option value="7">7</option>
  <option value="8">8</option>
  <option value="9">9</option>
  <option value="9A">9A</option>
  <option value="10">10</option>
  <option value="15">14</option>
  <option value="15">15</option>
  <option value="15">16</option>
  <option value="15">17</option>
  <option value="18">18</option>
  <option value="20">20</option>
  <option value="30">30</option>
  <option value="31">31</option>
</select>
<button onclick="updateBuses()">–ñ–∞“£–∞—Ä—Ç—É</button>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  // –ö–∞—Ä—Ç–∞–Ω—ã –∞—à–∞–º—ã–∑
  const map = L.map('map').setView([43.2981, 68.2386], 14);
  const greenIcon = L.icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
  shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});

const redIcon = L.icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
  shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});

  
  // OpenStreetMap “õ–∞–±–∞—Ç—ã–Ω “õ–æ—Å–∞–º—ã–∑
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // üîπ –ë–∞—Ä–ª—ã“õ –º–∞—Ä–∫–µ—Ä–ª–µ—Ä–¥—ñ –æ—Å—ã –º–∞—Å—Å–∏–≤—Ç–µ —Å–∞“õ—Ç–∞–π–º—ã–∑
  let markers = [];

  // üîπ –ê–≤—Ç–æ–±—É—Å—Ç–∞—Ä–¥—ã –∂–∞“£–∞—Ä—Ç—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã
  function updateBuses() {
    const number = document.getElementById('number').value;

    fetch(`https://app.alempay.kz/api/service-info/position/?format=json&lang=kz&region=12&route=${number}`)
      .then(res => res.json())
      .then(data => {
        // –ï—Å–∫—ñ –º–∞—Ä–∫–µ—Ä–ª–µ—Ä–¥—ñ –∫–∞—Ä—Ç–∞–¥–∞–Ω ”©—à—ñ—Ä–µ–º—ñ–∑
        markers.forEach(m => map.removeLayer(m));
        markers = [];

        // –ñ–∞“£–∞ –º–∞—Ä–∫–µ—Ä–ª–µ—Ä–¥—ñ –∫–∞—Ä—Ç–∞“ì–∞ “õ–æ—Å–∞–º—ã–∑
        data.pos.forEach(bus => {
            const icon = bus.dir === 1 ? greenIcon : redIcon;
            const marker = L.marker([bus.lat, bus.lon], { icon })
                .addTo(map)
                .bindPopup(`–ê–≤—Ç–æ–±—É—Å ‚Ññ${number}<br>–ë–∞“ì—ã—Ç: ${bus.dir === 1 ? "–ë–∞—Ä–∞ –∂–∞—Ç—ã—Ä" : "–ö–µ–ª—ñ–ø –∂–∞—Ç—ã—Ä"}`);
            
            markers.push(marker);
        });
      });
  }

  // üîπ –ê–ª“ì–∞—à“õ—ã –∂–∞“£–∞—Ä—Ç—É
  updateBuses();

  // üîπ ”ò—Ä 5 —Å–µ–∫—É–Ω–¥ —Å–∞–π—ã–Ω –∂–∞“£–∞—Ä—Ç—É
  setInterval(updateBuses, 5000);
</script>
</body>
</html>
